# 一夜狼人杀（CLI 热座版）

一个用 Python 实现的「一夜狼人杀」命令行热座版。支持6人固定配置与夜间行动、讨论计时、保密投票、自动结算与胜负判定，可选展示夜晚行动日志。

## 功能特点
- **6人固定配置**：包含9张角色牌（场上6张 + 中央3张）
- **完整流程**：准备 → 夜晚行动 → 讨论阶段（倒计时，可跳过）→ 投票 → 结算
- **夜晚行动**：按官方顺序执行（狼人、爪牙、预言家、强盗、捣蛋鬼、酒鬼、失眠者）
- **保密交互**：私密输入与热座提示，避免泄露信息
- **自动结算**：根据票型与角色规则判断出局与胜负（包含猎人被处决的连带效果）
- **可选夜间日志**：结算后可展示夜间行动摘要

## 目录结构
```
Werewolves/
  README.md              # 使用说明（本文件）
  werewolves_cli.py      # 程序入口（CLI）
  game_engine.py         # 游戏引擎与玩家类
  roles.py               # 角色与夜晚行动实现
  resolver.py            # 投票统计与胜负判定
  ui.py                  # 交互式命令行 UI
  一夜狼人杀规则.txt        # 规则参考（中文）
```

## 运行要求
- Python 3.8+
- 纯标准库，无第三方依赖

## 快速开始
在项目根目录执行：
```bash
python werewolves_cli.py --names "A,B,C,D,E,F" --timer 180 --reveal-log
```

### CLI 参数
- `--names`：6名玩家名，逗号分隔。默认 `P1,P2,P3,P4,P5,P6`。
- `--seed`：随机种子（整数）。用于复现实验或教学演示。
- `--timer`：讨论时长（秒）。默认 180。
- `--reveal-log`：结算后展示夜间行动日志的开关（布尔旗标）。

示例：
```bash
# 使用固定玩家名、120秒讨论、展示夜间日志
python werewolves_cli.py --names "Alice,Bob,Carol,David,Eve,Frank" --timer 120 --reveal-log

# 为了复现实验，设定随机种子
python werewolves_cli.py --seed 42
```

## 游戏流程概览
1. **准备阶段**（setup）
   - 从 9 张预设角色中洗牌，发给 6 名玩家；剩余 3 张置于中央。
   - 每位玩家私下确认初始身份。
2. **夜晚阶段**（night）
   - 按顺序依次唤醒拥有对应角色的玩家执行行动：
     - 狼人（Werewolf）
     - 爪牙（Minion）
     - 预言家（Seer）
     - 强盗（Robber）
     - 捣蛋鬼（Troublemaker）
     - 酒鬼（Drunk）
     - 失眠者（Insomniac）
3. **讨论阶段**（discussion）
   - 公共讨论，计时器显示剩余时间；按回车可直接跳过。
4. **投票阶段**（voting）
   - 热座保密逐人投票，不能投自己。
5. **结算**
   - 统计最高票出局（全员一票则无人死亡）。
   - 若猎人（Hunter）被处决，所有投给猎人的玩家也出局。
   - 根据场上是否有狼人/爪牙与死亡情况判定胜负。

## 角色与行动（入门 6 人配置）
预设 9 张角色牌：
- 狼人 Werewolf ×2：
  - 多狼互认；若独狼，可查看一张中央牌。
- 爪牙 Minion ×1：
  - 知道所有狼人的身份；若无狼人，爪牙单挑局的胜负条件不同（见下）。
- 预言家 Seer ×1：
  - 可选择查看一名玩家身份，或查看两张中央牌。
- 强盗 Robber ×1：
  - 可与一名玩家交换身份，并得知自己新身份。
- 捣蛋鬼 Troublemaker ×1：
  - 可选择两名玩家互换身份（自己不看、不变）。
- 酒鬼 Drunk ×1：
  - 必须与中央一张牌交换，但不会得知新身份。
- 失眠者 Insomniac ×1：
  - 夜晚最后查看自己的最终身份。
- 猎人 Hunter ×1：
  - 白天若被处决，则所有投给猎人的玩家也出局。

## 胜负判定（简述）
- 若场上有狼人：
  - 被处决者中包含狼人 → **好人胜**。
  - 无人被处决 → **狼人胜**。
  - 被处决者中没有狼人（但有人出局）→ **狼人胜**。
- 若场上无狼人：
  - 有爪牙：
    - 爪牙被处决 → **好人胜**。
    - 其他任意人被处决（有人出局）→ **狼人阵营胜（爪牙胜）**。
    - 无人出局 → **好人胜**。
  - 无爪牙：
    - 无人出局 → **好人胜**；有人出局 → **狼人阵营胜（好人失败）**。

> 详见 `resolver.py` 中的判定逻辑。

## 操作提示（热座模式）
- 夜晚阶段与投票阶段均采用「仅当前玩家可见」的屏幕提示。
- 传递键盘前请先清屏，程序会自动清屏并标注当前可见者。
- 讨论阶段按回车可跳过计时。

## 开发与扩展
- 引擎入口：`werewolves_cli.py`
- 游戏核心：`game_engine.py`（玩家、阶段流转、日志）
- 角色行动：`roles.py`（继承 `RoleAction` 并在 `ROLE_ACTIONS` 注册）
- 结算规则：`resolver.py`
- UI 交互：`ui.py`

可以通过以下方式扩展：
- 新增角色：定义 `Role` 枚举项与对应 `RoleAction` 子类，并加入 `NIGHT_ORDER` 与 `ROLE_ACTIONS`。
- 修改配置：调整 `GameEngine.SIX_PLAYER_STARTER_ROLES` 以改变发牌池。
- 多语言：当前交互为中文，可在 UI 层抽象文案以支持多语言。

## 常见问题
- Q：是否必须 6 人？
  - A：当前实现校验恰好 6 名玩家（见 `werewolves_cli.py`）。
- Q：能否查看夜晚行动详情？
  - A：运行时添加 `--reveal-log` 参数，结算后会展示夜间行动日志摘要。

## 许可
此项目用于学习与交流，未附带明确开源许可证。如需用于商业或二次分发，请先与作者沟通或补充许可证说明。
